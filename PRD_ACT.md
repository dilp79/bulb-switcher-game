# Требования и план реализации игры "Угадай переключатели лампочек"

## Общее описание проекта
**Название:** «Угадай переключатели лампочек»  
**Суть игры:** Головоломка, в которой игрок должен угадать скрытые связи между кнопками и лампочками, нажимая на кнопки, чтобы привести все лампочки в выключенное состояние.

## Функциональные компоненты

### 1. Автоматический генератор уровней
- **Параметры генерации:**
  - Количество кнопок (1-8)
  - Количество лампочек (1-8)
  - Количество цветов лампочек (2-4)
- **Алгоритм создания связей:**
  - Каждая лампочка должна быть связана минимум с одной кнопкой
  - Каждая кнопка должна быть связана минимум с одной лампочкой
  - Количество дополнительных связей увеличивается с ростом сложности
- **Формула сложности:**
  ```
  Сложность = 1 + десятичный логарифм((Количество кнопок + Количество лампочек) × Количество связей)
  ```
- **Создание начального состояния:**
  - Случайное нажатие кнопок (0 до количество_цветов+1 раз)
  - Гарантия, что хотя бы одна лампочка будет включена
- **Группировка уровней:**
  - Создаётся 3 блока по 10 уровней, отсортированные по сложности
  в первом блоке 1 уровень начинается с 1 кнопки и 1 лампочки, возрастает количество кнопок и лампочек, цветов только 2.
  во втором блоке 11 уровень начинается с 3х кнопок и 3х лампочек, возрастает количество кнопок и лампочек, цветов 3.
  в третьем блоке 21 уровень начинается с 3х кнопок и 3х лампочек, возрастает количество кнопок и лампочек, цветов 4.
  

  Формат сохранения уровней JSON
  {
    "name": "ИМЯ УРОВНЯ",
    "buttons_count": 1,
    "bulbs_count": 1,
    "colors_count": 2,
    "connections": [
        [
            0,
            0
        ]
    ],
    "target_states": [
        0
    ],
    "initial_states": [
        1
    ],
    "complexity": 1.3010299956639813,
    "block": 1
}
где часть Connections описывает связь кнопки и лампочки.
Файлы уровней сохранены в папке levels в подпапках blocks

### 2. Редактор уровней
- **Функциональность:**
  - Возможность задать количество кнопок, лампочек и цветов
  - Кнопка "recreate links" для очистки и генерации новых случайных связей
  - Визуальное отображение связей между кнопками и лампочками
  - Пользователь может нажать на кнопку и лампочку и инвертировать наличие связи между ними.
  - Кнопка "generate initial state" для генерации начального состояния включения лампочек.
  - Расчёт сложности уровня по формуле
  - Сохранение уровня в папку user_levels
  - Возможность удаления уровня из папки user_levels
  - возможность тут же включить игру на данном уровне
  

### 3. Игровая часть
- **Геймплей:**
  - Отображение начального состояния лампочек
  - Нажатие на кнопки переключает состояние связанных лампочек
  - Цель: привести все лампочки в выключенное состояние
  - Подсчёт ходов игрока
  - Таймер для фиксации времени прохождения
  - Одна подсказка на уровень (показывает связи для выбранной кнопки, звук hint.mp3)
  - звуковой эффект при нажатии кнопки (1 звук button_click.mp3). 
  - Эффект "салют" при успешном прохождении уровня и звук победы victory.mp3
- **Циклические состояния лампочек:**
   - Цветовая схема: серый (выкл), зелёный, жёлтый, красный и т.д. Файлы картинок bulb_off, bulb_green, bulb_yellow, bulb_red.
- **Сохранение прогресса:**
  - Последний уровень.
  - результаты по каждому уровню (время, количество ходов)
  - Для одного пользователя, без авторизации
- **Возможность выбора уровня**  
- пользователь может выбрать любой уровень из любого блока
- пользователь может выбрать любой уровень из папки user_levels

#### активы
1. в папке assets хранятся images и sounds. используй их. проверь размеры картинок.
2. не нужно изображение background
3. если понадобятся другие изображения или звуки - спроси меня, перед тем как менять названия файлов или создавать новые файлы assets.


## План реализации

### 1. Веб-версия для GitHub Pages
1. **Технологический стек:**
   - HTML5, CSS3, JavaScript
   - Фреймворк: Phaser.js для игрового движка
   - Хранение: LocalStorage для сохранения прогресса

2. **Этапы разработки:**
   - Создание базовой HTML-структуры и CSS стилей
   - Реализация игровой логики на JavaScript с Phaser.js
   - Разработка генератора уровней
   - Создание редактора уровней
   - Реализация сохранения прогресса в LocalStorage
   - Адаптивный дизайн для разных устройств (ПК, планшеты, телефоны)
   - Тестирование и отладка
   - Деплой на GitHub Pages

3. **Адаптация для разных устройств:**
   - Резиновый дизайн с использованием относительных единиц (%, vw, vh)
   - CSS Media Queries для разных разрешений экрана
   - Обработка как мышки, так и сенсорных событий

### 2. Telegram-версия
1. **Технологический стек:**
   - Тот же, что и для веб-версии с добавлением Telegram Mini Apps API
   - Telegram Games API для интеграции с системой лидерборда

2. **Этапы адаптации:**
   - Интеграция Telegram Mini Apps JavaScript SDK
   - Адаптация UI для вертикальных экранов мобильных устройств
   - Реализация Telegram-специфичных функций (отправка счёта в чат)
   - Настройка WebApp размеров и параметров отображения
   - Интеграция с Telegram бот API для запуска игры через бота
   - Тестирование в Telegram окружении

### 3. Версия для Android
1. **Варианты реализации:**
   - **PWA (Progressive Web App):**
     - Добавление веб-манифеста и сервис-воркеров к веб-версии
     - Настройка offline доступа к игре
     - Инструкции для установки как PWA на Android
   
   - **WebView-приложение:**
     - Создание оболочки на Java/Kotlin с WebView
     - Упаковка веб-версии внутри нативного приложения
     - Настройка доступа к локальному хранилищу Android

   - **Конвертация через фреймворк Capacitor/Cordova:**
     - Обёртка веб-версии в нативное приложение
     - Доступ к нативным возможностям устройства
     - Генерация APK для распространения

2. **Рекомендуемый подход:** PWA + опциональная обёртка через Capacitor для создания APK 